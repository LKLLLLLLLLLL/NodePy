# NodePy 前端系统架构设计文档

## 1. 总体架构设计

NodePy 前端采用 **Vue 3 + TypeScript + Pinia** 的现代化单页应用架构。系统主要由**路由管理**、**状态管理**、**组件系统**和 **API通信层**组成。

### 1.1 技术栈

| 技术 | 版本/框架 | 职责 |
| :--- | :--- | :--- |
| **Vue 3** | 最新版 | **视图层框架**。提供响应式数据绑定和组件化开发能力。 |
| **TypeScript** | 最新版 | **类型安全**。增强代码可维护性和开发体验。 |
| **Pinia** | 最新版 | **状态管理**。集中管理应用状态，实现跨组件状态共享。 |
| **Vue Router** | 最新版 | **路由管理**。处理页面导航和路由参数。 |
| **Axios** | 最新版 | **HTTP 客户端**。与后端API进行数据交互。 |
| **WebSocket** | 原生API | **实时通信**。接收项目执行状态和进度更新。 |

## 2. 页面功能简介 (`src/views`)

页面分为**首页**、**探索**、**工作台**、**文件**四个主页面，以及**登录/注册**页面。

*   **首页**：展示NodePy核心信息。
*   **探索**：展示NodePy官方提供的案例。点击案例可在当前标签页打开，查看案例输出结果。用户可以将案例**复制**到自己的项目中，进行自定义修改。
*   **工作台**：展示用户已创建的项目。点击项目卡片可在新标签页中打开项目编辑器进行编辑。
*   **文件**：展示用户已上传和生成的文件，提供预览功能。
*   **登录/注册页面**：提供登录/注册表单。注册成功后自动登录。

## 3. 页面详解

### 3.1 页面布局

*   所有主页面都分为 **控制栏 (`src/ControlBar`)** 和 **显示区 (`src/views`)** 两部分。
*   **登录/注册页面** 不显示控制栏。
*   页面之间的跳转由**路由 (`src/router/index`)** 实现。
    *   **控制栏**：提供页面切换、用户信息查看、项目信息展示等功能。
    *   **显示区**：用于显示各个页面的具体内容。

### 3.2 页面功能

#### 首页 (`views/Home`)
分为四个部分：
1.  **NodePy简介**：提供按钮跳转到GitHub首页或进入工作台（未登录会跳转至登录页）。
2.  **NodePy核心优势**
3.  **NodePy实例项目展示**
4.  **准备开始**：提供按钮跳转到探索页面或进入工作台（未登录会跳转至登录页）。

#### 登录/注册 (`views/Login`)
*   分为**登录**和**注册**两个子页面，可通过按钮切换。
*   **注册**：需要填写邮箱、用户名、密码和确认密码。注册成功后将账号信息同步到后端，并自动登录。
*   **登录**：支持使用邮箱+密码或用户名+密码登录。
*   登录成功后，用户方可访问除首页外的其他页面。

#### 探索 (`views/ExampleView`)
*   在探索页面 (`ExampleView/Example`) 中，以卡片形式 (`ExampleView/ExampleDemoFrame`) 展示所有NodePy官方创建的案例。
*   点击案例卡片会通过路由跳转到对应的**只读**探索项目页面，用户仅可查看运行结果。
*   提供 **“复制到我的项目”** 功能，可将案例项目添加到用户自己的工作台。确认操作后，数据将同步到后端。

#### 工作台 (`views/ProjectListView`)
*   工作台页面 (`ProjectListView/ProjectList`) 以卡片形式 (`ProjectListView/ProjectDemoFrame`) 展示用户创建的所有项目（包括从探索页面复制而来的案例）。
*   点击项目卡片会通过路由跳转到对应的项目编辑器页面。
*   项目卡片提供以下功能，每个功能都会唤起相应的弹窗：
    *   **创建项目** (`ProjectListView/CreateProject`)
    *   **修改项目设置** (`ProjectListView/UpdateProjectSetting`)
    *   **删除项目** (`ProjectListView/DeleteProject`)
*   所有操作在用户确认后，都会同步到后端。

#### 项目编辑器 (`views/Editor`)
*   在**探索**或**工作台**页面点击项目卡片后，通过路由跳转到对应的项目编辑器页面。
*   项目编辑器 (`Editor`) 会替代原来的 `views` 显示区内容。
*   项目编辑的核心功能通过 `src/components/Graph/Graph` 组件实现，该组件是节点拖动、连线等功能的主要载体。

##### 编辑器布局与功能
*   **布局**：
    *   主区域为节点画布。
    *   左下角为**节点图小地图**。
    *   底栏为**控制按钮**。
*   **功能**：
    *   用户可通过**右键**触发菜单 (`components/RightClickMenu`) 来选择并创建节点。
    *   支持**拖动**节点和**连接**节点。
    *   **双击节点**或**选中节点后点击“查看结果”按钮**，可以实时查看该节点的输出结果。
    *   所有操作（节点增删改、连线、执行等）都会同步到后端，结果会进行缓存以提高性能。

## 4. 弹窗管理系统

*   **弹窗管理器 (`src/ModalManager`)**：负责将弹窗组件渲染到整个应用的最上层。它借助 `modalStore` 进行独立的弹窗状态管理。
*   **弹窗主体 (`src/components/Modal`)**：控制弹窗的基础布局、结构和样式。其内部通过 `component` 属性接收并渲染具体的弹窗内容组件。弹窗自身的**拖动、改变大小和位置**等功能也在此组件中定义。
*   **弹窗状态库 (`src/stores/modalStore`)**：存储所有弹窗的打开、关闭等管理函数。部分功能特殊的弹窗，其管理逻辑可能放在其他相关模块中。

## 5. 核心组件 (`src/components`)

### `Graph`
*   **项目编辑器的内容主体**。负责渲染所有节点和边，并承载主要的用户交互逻辑（如拖拽、选择、连线等）。

### `nodes` 文件夹
*   所有**节点类型**的布局和具体功能都在此文件夹下的各个组件中定义。

### `Result`
*   所有节点或项目的**输出结果**都通过此组件展示。它会根据结果的数据类型（如图表、文本、表格等）采用不同的布局和交互方式进行渲染。

## 6. 其他通用组件 (`src/components`)

| 组件 | 描述 |
| :--- | :--- |
| **可编辑表格 (`EditableTable`)** | 支持用户直接编辑表格内容。 |
| **悬浮菜单 (`FloatingMenu`)** | 支持用户悬停以查看用户信息、执行登录/登出等操作。 |
| **通知 (`Notifications`)** | 向用户提供操作成功、失败或警告等反馈信息。 |
| **分页器 (`Pagination`)** | 用于分页展示大量内容（当前已停用）。 |
| **代码编辑器 (`PyEditor`)** | 支持用户编写和编辑自定义Python代码。 |
| **右键菜单 (`RightClickMenu`)** | 右键触发的上下文菜单，在项目编辑器中主要用于节点类型的选择。 |
| **加载 (`Loading`)** | 加载状态指示器。 |